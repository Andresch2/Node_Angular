<p-toast />

<div class="card">
  <div class="flex justify-between items-center mb-6">
    <div>
      <p-button icon="pi pi-arrow-left" [text]="true" (onClick)="goBack()" label="Volver">
      </p-button>
      <h2 class="text-3xl font-bold m-0 mt-2">{{ project()?.name }}</h2>
      <p class="text-muted-color mt-2">{{ project()?.description }}</p>
    </div>
    <p-button label="Nueva Tarea" icon="pi pi-plus" (onClick)="showDialog()">
    </p-button>
  </div>

  <div class="mb-4">
    <h3 class="text-xl font-semibold m-0">Tareas</h3>
  </div>

  <p-table [value]="tasks()" [loading]="loading()" styleClass="p-datatable-striped">
    <ng-template #header>
      <tr>
        <th>Título</th>
        <th>Descripción</th>
        <th>Estado</th>
        <th style="inline-size: 150px">Acciones</th>
      </tr>
    </ng-template>
    <ng-template #body let-task>
      <tr>
        <td>{{ task.title }}</td>
        <td>{{ task.description || '-' }}</td>
        <td>
          <p-tag [value]="getStatusLabel(task.status)" [severity]="getStatusSeverity(task.status)">
          </p-tag>
        </td>
        <td>
          <p-button icon="pi pi-check" [text]="true" [rounded]="true" severity="success"
            *ngIf="task.status !== 'COMPLETADA'" (onClick)="updateTaskStatus(task, 'COMPLETADA')" pTooltip="Completar">
          </p-button>
          <p-button icon="pi pi-pencil" [text]="true" [rounded]="true" severity="warn" (onClick)="showDialog(task)"
            pTooltip="Editar">
          </p-button>
          <p-button icon="pi pi-trash" [text]="true" [rounded]="true" severity="danger" (onClick)="deleteTask(task.id)"
            pTooltip="Eliminar">
          </p-button>
        </td>
      </tr>
    </ng-template>
    <ng-template #emptymessage>
      <tr>
        <td colspan="4" class="text-center py-8">
          <i class="pi pi-inbox text-4xl text-muted-color mb-4 block"></i>
          <p class="text-muted-color">No hay tareas en este proyecto</p>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<p-dialog [(visible)]="displayDialog" [modal]="true" [style]="{inline-size: '600px'}" header="Nueva Tarea">
  <div class="flex flex-col gap-4">
    <div>
      <label for="title" class="block mb-2 font-medium">Título *</label>
      <input pInputText id="title" [(ngModel)]="newTask.title" class="w-full" placeholder="Título de la tarea" />
    </div>

    <div>
      <label for="description" class="block mb-2 font-medium">Descripción</label>
      <textarea pInputTextarea id="description" [(ngModel)]="newTask.description" rows="3" class="w-full"
        placeholder="Descripción de la tarea">
      </textarea>
    </div>

    <div>
      <label for="status" class="block mb-2 font-medium">Estado</label>
      <p-dropdown [(ngModel)]="newTask.status" [options]="statusOptions" optionLabel="label" optionValue="value"
        placeholder="Selecciona un estado" styleClass="w-full">
      </p-dropdown>
    </div>
  </div>

  <ng-template #footer>
    <p-button label="Cancelar" severity="secondary" (onClick)="hideDialog()">
    </p-button>
    <p-button label="Guardar" [loading]="saving()" (onClick)="saveTask()">
    </p-button>
  </ng-template>
</p-dialog>